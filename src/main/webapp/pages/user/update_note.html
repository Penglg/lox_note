<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>lox笔记</title>
</head>
<body>
<div style="text-align: center">
    <h1>修改笔记</h1><br><br>

    <a href="http://localhost:8080/pages/user/note.html">返回主页</a><br><br>

    <form>
        <label for="n-title">标题</label>
        <input id="n-title" type="text"><br><br>
        <label for="n-content">内容</label>
        <input id="n-content" type="text"><br><br>
        <button id="update-btn">更新</button>
    </form>

</div>

<script src="../../js/jquery-3.6.0.js" type="text/javascript"></script>
<script>
    $(function () {
        let url = decodeURI(location.href);
        let args = url.split("?noteId="); // 获取url携带参数
        let noteId = args[1];

        $("#update-btn").click(function () {
            let title = $("#n-title").val();
            let content = $("#n-content").val();

            // 标题
            if (title != null && title !== "") {
                let titlePatt = /^\w{6,12}$/;
                if (!titlePatt.test(title)) {
                    alert("标题不合法！");
                    return false;
                }
            }

            if ((title == null || title === "") && (content == null || content === "")) {
                alert("标题内容不可都为空！");
                return false;
            }

            $.ajax({
                type: "put",
                url:"http://localhost:8080/notes",
                headers: {"Content-Type": "application/json;charset=UTF-8"},
                async: false,
                data: JSON.stringify({
                    id:noteId,
                    title:title,
                    content:content
                }),
                dataType:"json",
                success:function (result) {
                    if (result.code === 30001) {
                        alert("成功！");
                        history.go(-1);
                    } else {
                        alert("失败！");
                    }
                },
                error: function () {
                    alert("系统繁忙，稍后再试")
                }
            })
        })
    })

</script>
</body>
</html>