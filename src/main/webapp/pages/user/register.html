<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>lox笔记-用户注册</title>
</head>
<body>
<div style="text-align: center">
    <h2>注 册</h2>
    <form>
        <label for="u-name">昵称</label>
        <input id="u-name" type="text" name="name" placeholder="请输入昵称"><br><br>
        <label for="u-account">邮箱 </label>
        <input id="u-account" type="text" name="account" placeholder="请输入邮箱"><br><br>
        <label for="u-pwd">密码</label>
        <input id="u-pwd" type="password" name="password" placeholder="请输入密码"><br><br>
        <label for="u-repwd">确认密码</label>
        <input id="u-repwd" type="password" name="password" placeholder="请输入密码"><br><br>
        性别
        <input id="male" type="radio" name="sex" value="男"><label for="male">男</label>
        <input id="female" type="radio" name="sex" value="女"><label for="female">女</label><br><br>
        <div>
            <button id="register-btn">注册</button>
        </div>
    </form>

</div>

<script src="../../js/jquery-3.6.0.js" type="text/javascript"></script>
<script>
    $(document).ready(function () {
        $("#register-btn").click(function () {
            let name = $("#u-name").val();
            let account = $("#u-account").val();
            let password = $("#u-pwd").val();
            let repwd = $("#u-repwd").val();
            let sex = $('input[type=radio][name=sex]:checked').val();

            // 用户名
            let namePatt = /^\w{6,12}$/;
            if (!namePatt.test(name)) {
                alert("昵称不合法！");
                return false;
            }

            // 用户邮箱
            let accountPatt = /^([a-z0-9_.-]+)@([\da-z.-]+)\.([a-z.]{2,6})$/;
            if (!accountPatt.test(account)) {
                alert("邮箱不合法！");
                return false;
            }

            let passwordPatt = /^\w{6,15}$/;
            if (!passwordPatt.test(password)) {
                alert("密码不合法！");
                return false;
            }
            if (password != repwd) {
                alert("两次输入的密码不一致！");
                return false;
            }

            $.ajax({
                type:"post",
                url:"/users/register",
                async:false,
                headers:{"Content-Type":"application/json;charset=UTF-8"},
                data:JSON.stringify({
                    name:name,
                    account:account,
                    password:password,
                    sex:sex
                }),
                dataType:"json",
                success:function (data) {
                    if (data.code === 30001) {
                        alert("注册成功！");
                        history.go(-1);
                    } else {
                        alert("注册失败！");
                    }
                },
                error:function () {
                    alert("操作不合法！");
                }
            })
        })
    })


</script>
</body>
</html>