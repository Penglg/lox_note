<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>lox笔记-创建笔记</title>
</head>
<body>
<div style="text-align: center">
    <h1>新 建 笔 记</h1><br><br>

    <form>
        <label for="n-title">标题</label>
        <input id="n-title" type="text" placeholder="请输入标题"><br><br>
        <label for="n-content">内容</label>
        <input id="n-content" type="text" placeholder="请输入内容"><br><br>
        <div id="section-choose"></div>

        <button id="submit-btn" type="button">新建</button>


    </form>
</div>

<script src="../../js/jquery-3.6.0.js" type="text/javascript"></script>
<script>
    $(function () {
        $.ready(function () {
            $.ajax({
                type:"get",
                url:"http://localhost:8080/sections",
                success:function (result) {
                    let radios = "选择分区<br>";

                    for (let i = 0; i < result.data.length; ++i) {
                        let radioId = 'session' + i;
                        let radio = "<input id=" + radioId + "name='sessionId' value=" + result.data[i].id + ">" +
                            "<label for=" + radioId + ">" + result.data[i].name + "</label><br><br>";

                        radios = radios + radio;
                    }

                    $("section-choose").html(radios);
                }
            })
        })

        $("#submit-btn").click(function () {
            let title = $("#n-title").val();
            let content = $("#n-content").val();
            let sectionId = $('input[type=radio][name=seesionId]:checked').val();

            // 标题
            let titlePatt = /^\w{6,12}$/;
            if (!titlePatt.test(title)) {
                alert("标题不合法！");
                return false;
            }

            // 内容
            if (content == null || content === "") {
                alert("内容不能为空！");
                return false;
            }

            // 分区
            if (sessionId == null || sectionId === "") {
                alert("不可不选择分区！");
                return false;
            }

            $.ajax({
                type:"post",
                url:"http://localhost:8080/notes",
                async:"false",
                data:JSON.stringify({
                    title:title,
                    content:content,
                    sectionId:sectionId
                }),
                headers:{"Content-Type":"application/json;charset=UTF-8"},
                dataType:"json",
                success:function (result) {
                    if (result.code == 30001) {
                        alert("新建成功！");
                        history.go(-1);
                    } else {
                        alert("新建失败！");
                    }
                },
                error: function () {
                    alert("系统繁忙，稍后再试")
                }
            })
        })


    })

</script>
</body>
</html>