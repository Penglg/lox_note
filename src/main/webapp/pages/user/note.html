<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>lox笔记-首页</title>
</head>
<body>
<div style="text-align: center">
    <h1>lox笔记</h1><br>
    <a href="http://localhost:8080/pages/user/new_note.html">发布新笔记</a>
    <a href="http://localhost:8080/pages/user/update.html">修改个人信息</a><br><br>

<!--新增笔记-->


    <button id="legalNotes-btn">获取所有合法笔记</button>

<!--按分区获取笔记功能未实现-->
    <button id="sectionNotes-btn">根据分区查看笔记</button>

    <button id="userLegalNotes-btn">用户所有合法笔记</button>

    <button id="userIllegalNotes-btn">用户所有不合法笔记</button>

    <button id="likeNotes-btn">用户点赞的笔记</button>

    <button id="collectNotes-btn">用户收藏笔记</button><br><br>

    <div style="text-align: center">
        <table id="show" style="text-align: center"></table>
    </div>
</div>

<script src="../../js/jquery-3.6.0.js" type="text/javascript"></script>
<script>
    $(function () {

        // 查看所有合法笔记
        $("#legalNotes-btn").click(function () {
            $.ajax({
                type:"get",
                url:"http://localhost:8080/notes/all/1?pageNum=1",
                async:false,
                success: function (result) {
                    let table;

                    table = "<tr>" +
                        "<th>标题</th>" + "<th>分区</th>" + "<th>点赞数</th>" + "<th>收藏数</th>" + "<th>发布时间</th>" +
                        "<th>查看</th>" + "<th>点赞</th>" + "<th>收藏</th>" +
                        "</tr>";

                    for (let i = 0; i < result.data.items.length; ++i) {
                        let buttonId = "detail-btn" + i;
                        let likeBtnId = "like-btn" + i;
                        let collectBtnId = "collect-btn" + i;

                        let line = "<tr>" +
                            "<td>" + result.data.items[i].title + "</td>" +
                            "<td>" + result.data.items[i].section.name + "</td>" +
                            "<td>" + result.data.items[i].likes + "</td>" +
                            "<td>" + result.data.items[i].collect + "</td>" +
                            "<td>" + result.data.items[i].dateTime + "</td>" +
                            "<td><button id=" + buttonId + " >查看</button>" + "</td>" +
                            "<td><button id=" + likeBtnId + " >点赞</button>" + "</td>" +
                            "<td><button id=" + collectBtnId + " >收藏</button>" + "</td>" +
                            "</tr>";
                        table = table + line;
                    }

                    $("#show").html(table);

                    // 给每个按钮绑定操作
                    for (let i = 0; i < result.data.items.length; ++i) {
                        let buttonId = "detail-btn" + i;
                        let likeBtnId = "like-btn" + i;
                        let collectBtnId = "collect-btn" + i;

                        // 查看功能，即笔记详细页
                        $("#" + buttonId).click(function () {
                            location.href='http://localhost:8080/pages/user/note_detail.html?id=' + result.data.items[i].id;
                        })

                        // 点赞功能
                        $("#" + likeBtnId).click(function () {
                            $.ajax({
                                type:"post",
                                url:"/likes",
                                async:true,
                                headers:{"Content-Type":"application/json;charset=UTF-8"},
                                data:JSON.stringify({
                                    noteId:result.data.items[i].id
                                }),
                                dataType:"json",
                                success: function (result) {
                                    if (result.code === 30001) alert("点赞成功！");
                                    else alert("点赞失败！");
                                },
                                error: function () {
                                    alert("系统繁忙，稍后再试");
                                }
                            })
                        })

                        // 收藏功能
                        $("#" + collectBtnId).click(function () {
                            $.ajax({
                                type:"post",
                                url:"/collects",
                                async:true,
                                headers:{"Content-Type":"application/json;charset=UTF-8"},
                                data:JSON.stringify({
                                    noteId:result.data.items[i].id
                                }),
                                dataType:"json",
                                success: function (result) {
                                    if (result.code === 30001) alert("收藏成功！");
                                    else alert("收藏失败！");
                                },
                                error: function () {
                                    alert("系统繁忙，稍后再试");
                                }
                            })
                        })
                    }
                }
            })
        })

        // 查看用户合法笔记
        $("#userLegalNotes-btn").click(function () {
            $.ajax({
                type:"get",
                url:"http://localhost:8080/notes/my_notes/legal?pageNum=1",
                async:false,
                success:function (result) {
                    let table;

                    table = "<tr>" +
                        "<th>标题</th>" + "<th>分区</th>" + "<th>点赞数</th>" + "<th>收藏数</th>" + "<th>发布时间</th>" +
                        +"<th>查看</th>" + "<th>修改</th>" + "<th>删除</th>" +
                        "</tr>";

                    for (let i = 0; i < result.data.items.length; ++i) {
                        let detailBtnId = "detail-btn" + i;
                        let updateBtnId = "update-btn" + i;
                        let deleteBtnId = "delete-btn" + i;

                        let line = "<tr>" +
                            "<td>" + result.data.items[i].title + "</td>" +
                            "<td>" + result.data.items[i].section.name + "</td>" +
                            "<td>" + result.data.items[i].likes + "</td>" +
                            "<td>" + result.data.items[i].collect + "</td>" +
                            "<td>" + result.data.items[i].dateTime + "</td>" +
                            "<td><button id=" + detailBtnId + ">查看</button>" + "</td>" +
                            "<td><button id=" + updateBtnId + ">修改</button>" + "</td>" +
                            "<td><button id=" + deleteBtnId + ">删除</button>" + "</td>" +
                        "</tr>";
                        table = table + line;
                    }

                    $("#show").html(table);

                    for (let i = 0; i < result.data.items.length; ++i) {
                        let detailBtnId = "detail-btn" + i;
                        let updateBtnId = "update-btn" + i;
                        let deleteBtnId = "delete-btn" + i;

                        // 查看功能，即笔记详细页
                        $("#" + detailBtnId).click(function () {
                            location.href='http://localhost:8080/pages/user/note_detail.html?id=' + result.data.items[i].id;
                        })

                        // 修改功能
                        $("#" + updateBtnId).click(function () {
                            location.href='http://localhost:8080/pages/user/update_note.html?noteId=' + result.data.items[i].id;
                        })

                        // 删除功能
                        $("#" + deleteBtnId).click(function () {
                            let r = confirm("您确定删除笔记吗？")
                            if (r === true) {
                                $.ajax({
                                    type: "delete",
                                    url:"/notes/" + result.data.items[i].id,
                                    async:true,
                                    success: function (result) {
                                        if (result.code === 30001) alert("删除成功！");
                                        else alert("删除失败！");
                                    },
                                    error: function () {
                                        alert("系统繁忙，稍后再试");
                                    }
                                })
                            } else {

                            }
                        })
                    }
                }
            })
        })

        // 查看用户不合法笔记
        $("#userIllegalNotes-btn").click(function () {
            $.ajax({
                type:"get",
                url:"http://localhost:8080/notes/my_notes/illegal?pageNum=1",
                async:false,
                success:function (result) {
                    let table;

                    table = "<tr>" +
                        "<th>标题</th>" + "<th>分区</th>" + "<th>点赞数</th>" + "<th>收藏数</th>" + "<th>发布时间</th>" +
                        +"<th>查看</th>" + "<th>修改</th>" + "<th>删除</th>" +
                        "</tr>";

                    for (let i = 0; i < result.data.items.length; ++i) {
                        let detailBtnId = "detail-btn" + i;
                        let updateBtnId = "update-btn" + i;
                        let deleteBtnId = "delete-btn" + i;

                        let line = "<tr>" +
                            "<td>" + result.data.items[i].title + "</td>" +
                            "<td>" + result.data.items[i].section.name + "</td>" +
                            "<td>" + result.data.items[i].likes + "</td>" +
                            "<td>" + result.data.items[i].collect + "</td>" +
                            "<td>" + result.data.items[i].dateTime + "</td>" +
                            "<td><button id=" + detailBtnId + ">查看</button>" + "</td>" +
                            "<td><button id=" + updateBtnId + ">修改</button>" + "</td>" +
                            "<td><button id=" + deleteBtnId + ">删除</button>" + "</td>" +
                            "</tr>";
                        table = table + line;
                    }

                    $("#show").html(table);

                    for (let i = 0; i < result.data.items.length; ++i) {
                        let detailBtnId = "detail-btn" + i;
                        let updateBtnId = "update-btn" + i;
                        let deleteBtnId = "delete-btn" + i;

                        // 查看功能，即笔记详细页
                        $("#" + detailBtnId).click(function () {
                            location.href='http://localhost:8080/pages/user/note_detail.html?id=' + result.data.items[i].id;
                        })

                        // 修改功能
                        $("#" + updateBtnId).click(function () {
                            location.href='http://localhost:8080/pages/user/update_note.html?noteId=' + result.data.items[i].id;
                        })

                        // 删除功能
                        $("#" + deleteBtnId).click(function () {
                            let r = confirm("您确定删除笔记吗？");
                            if (r === true) {
                                $.ajax({
                                    type: "delete",
                                    url:"/notes/" + result.data.items[i].id,
                                    async:true,
                                    success: function (result) {
                                        if (result.code === 30001) alert("删除成功！");
                                        else alert("删除失败！");
                                    },
                                    error: function () {
                                        alert("系统繁忙，稍后再试");
                                    }
                                })
                            } else {

                            }
                        })
                    }
                }
            })
        })

        // 查看用户点赞的笔记
        $("#likeNotes-btn").click(function () {
            $.ajax({
                type:"get",
                url:"http://localhost:8080/notes/my_notes/like?pageNum=1",
                async:false,
                success:function (result) {
                    let table;

                    table = "<tr>" +
                        "<th>标题</th>" + "<th>分区</th>" + "<th>点赞数</th>" + "<th>收藏数</th>" + "<th>发布时间</th>" +
                        +"<th>查看</th>" + "<th>取消点赞</th>" +
                        "</tr>";

                    for (let i = 0; i < result.data.items.length; ++i) {
                        let detailBtnId = "detail-btn" + i;
                        let unlikeBtnId = "unlike-btn" + i;

                        let line = "<tr>" +
                            "<td>" + result.data.items[i].title + "</td>" +
                            "<td>" + result.data.items[i].section.name + "</td>" +
                            "<td>" + result.data.items[i].likes + "</td>" +
                            "<td>" + result.data.items[i].collect + "</td>" +
                            "<td>" + result.data.items[i].dateTime + "</td>" +
                            "<td><button id=" + detailBtnId + ">查看</button>" + "</td>" +
                            "<td><button id=" + unlikeBtnId + ">取消点赞</button>" + "</td>" +
                            "</tr>";
                        table = table + line;
                    }

                    $("#show").html(table);

                    for (let i = 0; i < result.data.items.length; ++i) {
                        let detailBtnId = "detail-btn" + i;
                        let unlikeBtnId = "unlike-btn" + i;

                        // 查看功能，即笔记详细页
                        $("#" + detailBtnId).click(function () {
                            location.href='http://localhost:8080/pages/user/note_detail.html?id=' + result.data.items[i].id;
                        })

                        // 取消点赞功能
                        $("#" + unlikeBtnId).click(function () {
                            let r = confirm("您确定取消点赞吗？");
                            if (r === true) {
                                $.ajax({
                                    type:"delete",
                                    url:"/likes/" + result.data.items[i].id,
                                    async:true,
                                    success : function (result) {
                                        if (result.code === 30001) alert("取消点赞成功！！");
                                        else alert("取消点赞失败！");
                                    },
                                    error : function () {
                                        alert("系统繁忙，稍后再试");
                                    }
                                })
                            } else {

                            }
                        })
                    }
                }
            })
        })

        // 获取收藏的笔记
        $("#collectNotes-btn").click(function () {
            $.ajax({
                type:"get",
                url:"http://localhost:8080/notes/my_notes/collect?pageNum=1",
                async:false,
                success:function (result) {
                    let table;

                    table = "<tr>" +
                        "<th>标题</th>" + "<th>分区</th>" + "<th>点赞数</th>" + "<th>收藏数</th>" + "<th>发布时间</th>" +
                        +"<th>查看</th>" + "<th>取消点赞</th>" +
                        "</tr>";

                    for (let i = 0; i < result.data.items.length; ++i) {
                        let detailBtnId = "detail-btn" + i;
                        let noteCollectBtnId = "notCollect-btn" + i;

                        let line = "<tr>" +
                            "<td>" + result.data.items[i].title + "</td>" +
                            "<td>" + result.data.items[i].section.name + "</td>" +
                            "<td>" + result.data.items[i].likes + "</td>" +
                            "<td>" + result.data.items[i].collect + "</td>" +
                            "<td>" + result.data.items[i].dateTime + "</td>" +
                            "<td><button id=" + detailBtnId + ">查看</button>" + "</td>" +
                            "<td><button id=" + noteCollectBtnId + ">取消收藏</button>" + "</td>" +
                            "</tr>";
                        table = table + line;
                    }

                    $("#show").html(table);

                    for (let i = 0; i < result.data.items.length; ++i) {
                        let detailBtnId = "detail-btn" + i;
                        let noteCollectBtnId = "notCollect-btn" + i;

                        // 查看功能，即笔记详细页
                        $("#" + detailBtnId).click(function () {
                            location.href='http://localhost:8080/pages/user/note_detail.html?id=' + result.data.items[i].id;
                        })

                        // 取消点赞功能
                        $("#" + noteCollectBtnId).click(function () {
                            let r = confirm("您确定取消收藏吗？");
                            if (r === true) {
                                $.ajax({
                                    type:"delete",
                                    url: "/collects/" + result.data.items[i].id,
                                    async:true,
                                    success: function (result) {
                                        if (result.code === 30001) alert("取消收藏成功！");
                                        else alert("取消收藏失败！");
                                    },
                                    error : function () {
                                        alert("系统繁忙，稍后再试！");
                                    }
                                })
                            }
                        })
                    }
                }
            })
        })

        $("#sectionNotes-btn").click(function () {
            location.href='http://localhost:8080/pages/user/section_note.html';
        })
    })

</script>
</body>
</html>