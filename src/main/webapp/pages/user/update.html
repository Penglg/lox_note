<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>lox笔记-用户信息修改</title>
</head>
<body>
<div style="text-align: center">
    <h1>用户信息修改</h1>
    <form>
        <input type="hidden" id="user" value="<%=user %>">
        <label for="u-name">昵称 </label>
        <input id="u-name" type="text" ><br><br>
        <label for="u-account" >账号 </label>
        <input id="u-account" type="text"><br><br>
        <label for="u-password" >密码 </label>
        <input id="u-password" type="text" ><br><br>
        <button id="update-btn"></button>
    </form>
</div>

<script src="../../js/jquery-3.6.0.js" type="text/javascript"></script>
<script>
    $(function () {
        $("#update-btn").click(function () {

            let name = $("#u-name").val();
            let account = $("#u-account").val();
            let password = $("#u-password").val();

            // alert("id:" + id + ", name:" + name + ", account:" + account + ", password:" + password);
            alert(user);

            // 用户名
            if (name != null && name != '') {
                let namePatt = /^\w{6,12}$/;
                if (!namePatt.test(name)) {
                    alert("昵称不合法！");
                    return false;
                }
            }

            // 用户邮箱
            if (account != null && account != '') {
                let accountPatt = /^([a-z0-9_.-]+)@([\da-z.-]+)\.([a-z.]{2,6})$/;
                if (!accountPatt.test(account)) {
                    alert("邮箱不合法！");
                    return false;
                }
            }

            // 用户密码
            if (password != null && password != '') {
            let passwordPatt = /^\w{6,15}$/;
            if (!passwordPatt.test(password)) {
                alert("密码不合法！");
                return false;
            }
            }

            $.ajax({
                type:"put",
                url:"/users",
                async:false,
                headers:{"Content-Type":"application/json;charset=UTF-8"},
                data:JSON.stringify({
                    name:name,
                    account:account,
                    password:password
                }),
                dataType:"json",
                success: function (result) {
                    if (result.code == 30001) {
                        alert("修改成功！");
                    } else {
                        alert("修改失败！");
                    }
                    history.go(-1);
                },
                error: function () {
                    alert("系统繁忙，稍后重试");
                }

            })
        })


    })

</script>
</body>
</html>